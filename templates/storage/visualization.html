{% extends 'main/base.html' %}
{% block link %}
{% load static %}
  <script  src="{% static 'storage/js/visualization.js' %}" rel="stylesheet" ></script>
  <link rel="stylesheet" href="{% static 'storage/css/visualization.css' %}">
  <script>
        const storageList = '{{storage_list}}',
            getCellsUrl = "{% url 'cells' %}",
            storageFullnessUrl = "{% url 'storage_fullness' %}"
        var marginStep = 0,
            marginLeft = 5,
            cellInformation = [],
            maxScale = 3,
            maxScaleSpace = 4.25,
            wsStart = 'ws://'
        loc = window.location;
        if (loc.protocol == 'https:') {
            wsStart = 'wss://'
        }
      $(document).ready(function(){
        var storageFullInfo = getStorageInfo()
        console.log(storageFullInfo)
        canvasDraw()
        buildStorages(storageList,storageFullInfo)
        var storage_socket = new WebSocket(wsStart+window.location.hostname+':'+window.location.port+'/ws/storage-ws/'+WORKER_ID)

      })
  </script>
{% endblock %}
{% block content %}
 <div class="content">
        <div id = "view-space">
            <div class="visualize-header">
                <div class="settings">

                </div>
                <div class="counter-container">
                    <span class="sign counter text" id="full-span">Занято -</span>
                    <span class="sign counter text" id="free-span">Свободно -</span>
                    <span class="sign counter text" id="lock-span">Заблокировано -</span>
                    <span class="sign counter text" id="lock-full-span">Занято и заблокировано -</span>
                </div>
                <div class="legend">
                    <span class="sign title main-title">Легенда</span>
                    <span class="sign title">Индикация заполненности</span>
                    <div class="scale">

                    </div>
                    <canvas width="350" height="20" id="legend-canvas">
                    </canvas>
                    <div class="canvas-sign">
                        <span class="text" style="font-weight:600; margin-left:-11px">0%</span>
                        <span class="text" style="font-weight:400; padding-right:25px">Свободно</span>
                        <span class="text" style="font-weight:400; padding-left: 30px">Занято</span>
                        <span class="text" style="font-weight:600; margin-right: -20px">100%</span>
                    </div>
                </div>
            </div>
            <div class="storage-view">
                {% for storage in storage_list %}
                <div class="storage-container">
                    <div class="storage-header">
                        <h1 class="sign storage-sign">{{storage}}</h1>
                        <div class="view-setting-button close" id="{{storage}}_OC" onclick="OCStorage(this.id)" style="transform:rotate(180deg)"></div>
                    </div>
                    <div class = "storage_template" id="{{storage}}">

                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
 </div>
{% endblock %}
